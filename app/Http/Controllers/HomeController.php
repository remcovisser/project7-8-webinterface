<?php
namespace App\Http\Controllers;
use App\Device;
use App\Location;

class HomeController extends Controller
{
    // Return the index view with all the devices
    public function index() {
        $devices = Device::with('locations')->get();

        return view('home.index', compact('devices'));
    }

    // Return the last know location for each device
    public function getLastLocation() {
        return Location::groupBy('device_id')->get();
    }

    // Return all the know locations for each device for this day
    public function getDailyLocations() {
        $data = [];
        $devices = Device::all();
        foreach($devices as $device) {
            $data[$device->id]['device_id'] = $device->id;
            $data[$device->id]['facility_id'] = $device->facility_id;
            $data[$device->id]['locations'] = $device->locations->toArray();
        }
        return $data;
    }

    // Temp -- seed locations
    public function seedLocations() {

        $locations = [
            [52.0951083, 4.3983633, '2017-06-28 17:10:31', '2017-06-28 17:10:31'],
            [52.0950917, 4.3983233, '2017-06-28 17:10:36', '2017-06-28 17:10:36'],
            [52.0950817, 4.3983750, '2017-06-28 17:10:42', '2017-06-28 17:10:42'],
            [52.0949050, 4.3983367, '2017-06-28 17:10:47', '2017-06-28 17:10:47'],
            [52.0951283, 4.3981800, '2017-06-28 17:10:52', '2017-06-28 17:10:52'],
            [52.0951133, 4.3982450, '2017-06-28 17:10:57', '2017-06-28 17:10:57'],
            [52.0951433, 4.3982167, '2017-06-28 17:11:02', '2017-06-28 17:11:02'],
            [52.0951333, 4.3982367, '2017-06-28 17:11:08', '2017-06-28 17:11:08'],
            [52.0951250, 4.3982750, '2017-06-28 17:11:13', '2017-06-28 17:11:13'],
            [52.0951200, 4.3983067, '2017-06-28 17:11:18', '2017-06-28 17:11:18'],
            [52.0951200, 4.3983350, '2017-06-28 17:11:23', '2017-06-28 17:11:23'],
            [52.0951483, 4.3983367, '2017-06-28 17:11:28', '2017-06-28 17:11:28'],
            [52.0951733, 4.3983183, '2017-06-28 17:11:34', '2017-06-28 17:11:34'],
            [52.0951750, 4.3983133, '2017-06-28 17:11:39', '2017-06-28 17:11:39'],
            [52.0951750, 4.3983133, '2017-06-28 17:11:44', '2017-06-28 17:11:44'],
            [52.0951750, 4.3983133, '2017-06-28 17:11:49', '2017-06-28 17:11:49'],
            [52.0952050, 4.3983383, '2017-06-28 17:11:55', '2017-06-28 17:11:55'],
            [52.0951850, 4.3983450, '2017-06-28 17:12:00', '2017-06-28 17:12:00'],
            [52.0951650, 4.3983633, '2017-06-28 17:12:05', '2017-06-28 17:12:05'],
            [52.0951650, 4.3983717, '2017-06-28 17:12:10', '2017-06-28 17:12:10'],
            [52.0951517, 4.3983650, '2017-06-28 17:12:16', '2017-06-28 17:12:16'],
            [52.0951517, 4.3983650, '2017-06-28 17:12:21', '2017-06-28 17:12:21'],
            [52.0951517, 4.3983650, '2017-06-28 17:12:26', '2017-06-28 17:12:26'],
            [52.0951667, 4.3984517, '2017-06-28 17:12:31', '2017-06-28 17:12:31'],
            [52.0952083, 4.3985350, '2017-06-28 17:12:36', '2017-06-28 17:12:36'],
            [52.0954267, 4.3988100, '2017-06-28 17:12:42', '2017-06-28 17:12:42'],
            [52.0954767, 4.3989533, '2017-06-28 17:12:47', '2017-06-28 17:12:47'],
            [52.0955150, 4.3990367, '2017-06-28 17:12:52', '2017-06-28 17:12:52'],
            [52.0955117, 4.3991100, '2017-06-28 17:12:57', '2017-06-28 17:12:57'],
            [52.0954983, 4.3991900, '2017-06-28 17:13:02', '2017-06-28 17:13:02'],
            [52.0955300, 4.3993683, '2017-06-28 17:13:08', '2017-06-28 17:13:08'],
            [52.0955833, 4.3995083, '2017-06-28 17:13:13', '2017-06-28 17:13:13'],
            [52.0956133, 4.3996300, '2017-06-28 17:13:18', '2017-06-28 17:13:18'],
            [52.0956567, 4.3997050, '2017-06-28 17:13:24', '2017-06-28 17:13:24'],
            [52.0956667, 4.3997067, '2017-06-28 17:13:29', '2017-06-28 17:13:29'],
            [52.0957733, 4.3998883, '2017-06-28 17:13:34', '2017-06-28 17:13:34'],
            [52.0958017, 4.3999067, '2017-06-28 17:13:39', '2017-06-28 17:13:39'],
            [52.0958467, 4.3999300, '2017-06-28 17:13:44', '2017-06-28 17:13:44'],
            [52.0959150, 4.3998467, '2017-06-28 17:13:50', '2017-06-28 17:13:50'],
            [52.0959617, 4.3997617, '2017-06-28 17:13:55', '2017-06-28 17:13:55'],
            [52.0959650, 4.3997567, '2017-06-28 17:14:00', '2017-06-28 17:14:00'],
            [52.0960167, 4.3997250, '2017-06-28 17:14:05', '2017-06-28 17:14:05'],
            [52.0960900, 4.3996900, '2017-06-28 17:14:10', '2017-06-28 17:14:10'],
            [52.0961333, 4.3996783, '2017-06-28 17:14:16', '2017-06-28 17:14:16'],
            [52.0961350, 4.3996867, '2017-06-28 17:14:21', '2017-06-28 17:14:21'],
            [52.0961817, 4.3996783, '2017-06-28 17:14:26', '2017-06-28 17:14:26'],
            [52.0962233, 4.3996500, '2017-06-28 17:14:31', '2017-06-28 17:14:31'],
            [52.0962950, 4.3996000, '2017-06-28 17:14:37', '2017-06-28 17:14:37'],
            [52.0963583, 4.3995583, '2017-06-28 17:14:42', '2017-06-28 17:14:42'],
            [52.0964267, 4.3995000, '2017-06-28 17:14:47', '2017-06-28 17:14:47'],
            [52.0964950, 4.3994300, '2017-06-28 17:14:52', '2017-06-28 17:14:52'],
            [52.0965600, 4.3993800, '2017-06-28 17:14:57', '2017-06-28 17:14:57'],
            [52.0966367, 4.3993033, '2017-06-28 17:15:03', '2017-06-28 17:15:03'],
            [52.0966983, 4.3992483, '2017-06-28 17:15:08', '2017-06-28 17:15:08'],
            [52.0967317, 4.3992233, '2017-06-28 17:15:13', '2017-06-28 17:15:13'],
            [52.0967883, 4.3992300, '2017-06-28 17:15:18', '2017-06-28 17:15:18'],
            [52.0968617, 4.3991900, '2017-06-28 17:15:24', '2017-06-28 17:15:24'],
            [52.0969367, 4.3991567, '2017-06-28 17:15:29', '2017-06-28 17:15:29'],
            [52.0970067, 4.3990933, '2017-06-28 17:15:34', '2017-06-28 17:15:34'],
            [52.0970717, 4.3990500, '2017-06-28 17:15:39', '2017-06-28 17:15:39'],
            [52.0971067, 4.3990417, '2017-06-28 17:15:45', '2017-06-28 17:15:45'],
            [52.0971100, 4.3990267, '2017-06-28 17:15:50', '2017-06-28 17:15:50'],
            [52.0971583, 4.3989833, '2017-06-28 17:15:55', '2017-06-28 17:15:55'],
            [52.0972233, 4.3989333, '2017-06-28 17:16:00', '2017-06-28 17:16:00'],
            [52.0972300, 4.3988517, '2017-06-28 17:16:06', '2017-06-28 17:16:06'],
            [52.0972150, 4.3987400, '2017-06-28 17:16:11', '2017-06-28 17:16:11'],
            [52.0971883, 4.3986250, '2017-06-28 17:16:16', '2017-06-28 17:16:16'],
            [52.0971717, 4.3984900, '2017-06-28 17:16:21', '2017-06-28 17:16:21'],
            [52.0971233, 4.3983683, '2017-06-28 17:16:27', '2017-06-28 17:16:27'],
            [52.0970783, 4.3982967, '2017-06-28 17:16:32', '2017-06-28 17:16:32'],
            [52.0970300, 4.3982467, '2017-06-28 17:16:37', '2017-06-28 17:16:37'],
            [52.0969817, 4.3981733, '2017-06-28 17:16:42', '2017-06-28 17:16:42'],
            [52.0969083, 4.3980783, '2017-06-28 17:16:48', '2017-06-28 17:16:48'],
            [52.0968517, 4.3980150, '2017-06-28 17:16:53', '2017-06-28 17:16:53'],
            [52.0967933, 4.3979633, '2017-06-28 17:16:58', '2017-06-28 17:16:58'],
            [52.0967400, 4.3979117, '2017-06-28 17:17:03', '2017-06-28 17:17:03'],
            [52.0967233, 4.3979183, '2017-06-28 17:17:08', '2017-06-28 17:17:08'],
            [52.0966567, 4.3978400, '2017-06-28 17:17:14', '2017-06-28 17:17:14'],
            [52.0965967, 4.3977467, '2017-06-28 17:17:19', '2017-06-28 17:17:19'],
            [52.0965383, 4.3976700, '2017-06-28 17:17:24', '2017-06-28 17:17:24'],
            [52.0964783, 4.3975983, '2017-06-28 17:17:29', '2017-06-28 17:17:29'],
            [52.0964117, 4.3975283, '2017-06-28 17:17:34', '2017-06-28 17:17:34'],
            [52.0963350, 4.3974617, '2017-06-28 17:17:40', '2017-06-28 17:17:40'],
            [52.0962833, 4.3974233, '2017-06-28 17:17:45', '2017-06-28 17:17:45'],
            [52.0962217, 4.3973800, '2017-06-28 17:17:50', '2017-06-28 17:17:50'],
            [52.0961617, 4.3973417, '2017-06-28 17:17:55', '2017-06-28 17:17:55'],
            [52.0961017, 4.3972933, '2017-06-28 17:18:01', '2017-06-28 17:18:01'],
            [52.0960483, 4.3972667, '2017-06-28 17:18:06', '2017-06-28 17:18:06'],
            [52.0960217, 4.3972100, '2017-06-28 17:18:11', '2017-06-28 17:18:11'],
            [52.0959600, 4.3971733, '2017-06-28 17:18:16', '2017-06-28 17:18:16'],
            [52.0959000, 4.3971367, '2017-06-28 17:18:21', '2017-06-28 17:18:21'],
            [52.0958267, 4.3971033, '2017-06-28 17:18:27', '2017-06-28 17:18:27'],
            [52.0957767, 4.3970700, '2017-06-28 17:18:32', '2017-06-28 17:18:32'],
            [52.0957350, 4.3969900, '2017-06-28 17:18:37', '2017-06-28 17:18:37'],
            [52.0956917, 4.3969000, '2017-06-28 17:18:42', '2017-06-28 17:18:42'],
            [52.0956317, 4.3967983, '2017-06-28 17:18:47', '2017-06-28 17:18:47'],
            [52.0955633, 4.3966917, '2017-06-28 17:18:53', '2017-06-28 17:18:53'],
            [52.0955167, 4.3966183, '2017-06-28 17:18:58', '2017-06-28 17:18:58'],
            [52.0954683, 4.3965400, '2017-06-28 17:19:03', '2017-06-28 17:19:03'],
            [52.0954167, 4.3964583, '2017-06-28 17:19:08', '2017-06-28 17:19:08'],
            [52.0953600, 4.3964017, '2017-06-28 17:19:13', '2017-06-28 17:19:13'],
            [52.0952850, 4.3963367, '2017-06-28 17:19:19', '2017-06-28 17:19:19'],
            [52.0952283, 4.3962883, '2017-06-28 17:19:24', '2017-06-28 17:19:24'],
            [52.0952250, 4.3962200, '2017-06-28 17:19:29', '2017-06-28 17:19:29'],
            [52.0952400, 4.3961433, '2017-06-28 17:19:34', '2017-06-28 17:19:34'],
            [52.0952533, 4.3960383, '2017-06-28 17:19:40', '2017-06-28 17:19:40'],
            [52.0952867, 4.3959517, '2017-06-28 17:19:45', '2017-06-28 17:19:45'],
            [52.0953167, 4.3958183, '2017-06-28 17:19:50', '2017-06-28 17:19:50'],
            [52.0953367, 4.3956450, '2017-06-28 17:19:56', '2017-06-28 17:19:56'],
            [52.0953133, 4.3954450, '2017-06-28 17:20:01', '2017-06-28 17:20:01'],
            [52.0953167, 4.3953733, '2017-06-28 17:20:06', '2017-06-28 17:20:06'],
            [52.0953550, 4.3952700, '2017-06-28 17:20:11', '2017-06-28 17:20:11'],
            [52.0953550, 4.3952700, '2017-06-28 17:20:17', '2017-06-28 17:20:17'],
            [52.0953550, 4.3952700, '2017-06-28 17:20:22', '2017-06-28 17:20:22'],
            [52.0954150, 4.3951500, '2017-06-28 17:20:27', '2017-06-28 17:20:27'],
            [52.0954150, 4.3951450, '2017-06-28 17:20:32', '2017-06-28 17:20:32'],
            [52.0954150, 4.3951450, '2017-06-28 17:20:37', '2017-06-28 17:20:37'],
            [52.0954150, 4.3951450, '2017-06-28 17:20:43', '2017-06-28 17:20:43'],
            [52.0954150, 4.3951450, '2017-06-28 17:20:48', '2017-06-28 17:20:48'],
            [52.0954150, 4.3951450, '2017-06-28 17:20:53', '2017-06-28 17:20:53'],
            [52.0954150, 4.3951450, '2017-06-28 17:20:58', '2017-06-28 17:20:58'],
            [52.0954317, 4.3950433, '2017-06-28 17:21:04', '2017-06-28 17:21:04'],
            [52.0954483, 4.3950617, '2017-06-28 17:21:09', '2017-06-28 17:21:09'],
            [52.0954267, 4.3950250, '2017-06-28 17:21:14', '2017-06-28 17:21:14'],
            [52.0954183, 4.3949833, '2017-06-28 17:21:19', '2017-06-28 17:21:19'],
            [52.0954250, 4.3949617, '2017-06-28 17:21:24', '2017-06-28 17:21:24'],
            [52.0954233, 4.3949533, '2017-06-28 17:21:30', '2017-06-28 17:21:30'],
            [52.0954233, 4.3949533, '2017-06-28 17:21:35', '2017-06-28 17:21:35'],
            [52.0954233, 4.3949533, '2017-06-28 17:21:40', '2017-06-28 17:21:40'],
            [52.0954233, 4.3949533, '2017-06-28 17:21:45', '2017-06-28 17:21:45'],
            [52.0954233, 4.3949533, '2017-06-28 17:21:51', '2017-06-28 17:21:51'],
            [52.0954233, 4.3949533, '2017-06-28 17:21:56', '2017-06-28 17:21:56'],
            [52.0954150, 4.3951300, '2017-06-28 17:22:01', '2017-06-28 17:22:01'],
            [52.0954883, 4.3952833, '2017-06-28 17:22:06', '2017-06-28 17:22:06'],
            [52.0955600, 4.3953983, '2017-06-28 17:22:12', '2017-06-28 17:22:12'],
            [52.0955800, 4.3954750, '2017-06-28 17:22:17', '2017-06-28 17:22:17'],
            [52.0955700, 4.3955067, '2017-06-28 17:22:22', '2017-06-28 17:22:22'],
            [52.0955583, 4.3955083, '2017-06-28 17:22:27', '2017-06-28 17:22:27'],
            [52.0955583, 4.3955083, '2017-06-28 17:22:32', '2017-06-28 17:22:32'],
            [52.0955583, 4.3955083, '2017-06-28 17:22:38', '2017-06-28 17:22:38'],
            [52.0955350, 4.3957033, '2017-06-28 17:22:43', '2017-06-28 17:22:43'],
            [52.0955233, 4.3956800, '2017-06-28 17:22:48', '2017-06-28 17:22:48'],
            [52.0955050, 4.3956500, '2017-06-28 17:22:53', '2017-06-28 17:22:53'],
            [52.0954383, 4.3955683, '2017-06-28 17:22:59', '2017-06-28 17:22:59'],
            [52.0953550, 4.3954067, '2017-06-28 17:23:04', '2017-06-28 17:23:04'],
            [52.0952683, 4.3952533, '2017-06-28 17:23:09', '2017-06-28 17:23:09']
        ];

        foreach ($locations as $pos)
        {
            $location = new Location();
            $location->gps_latitude = $pos[0];
            $location->gps_longitude = $pos[1];
            $location->created_at = $pos[2];
            $location->updated_at = $pos[3];
            $location->device_id = 1;

            $location->gps_accuracy = 0;
            $location->bt_latitude = 0.0;
            $location->bt_longitude = 0.0;
            $location->bt_accuracy = 0;

            $location->save();
        }

        return response("Done");
    }
}